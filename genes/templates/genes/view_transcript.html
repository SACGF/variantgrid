{% extends "uicore/page/base.html" %}
{% load crispy_forms_field %}
{% load ui_help %}
{% load ui_utils %}
{% load ui_menu_bars %}
{% block title %}Transcript: {{ transcript }}{% endblock title %}
{% block submenu %}{% menu_bar_data %}{% endblock %}

{% block content %}
    <div class="container">
        <h3>Transcript {{ transcript }}</h3>

        {% if transcript.annotation_consortium == 'R' %}
            {% page_help 'genes/transcript_version_refseq' 'RefSeq Transcript Versions' %}
        {% elif transcript.annotation_consortium == 'E' %}
            {% page_help 'genes/transcript_version_ensembl' 'Ensembl Transcript Versions' %}
        {% endif %}

        {% for genome_build_genes in genome_build_genes %}
            {% labelled label=genome_build_genes.genome_build|append:" Gene" %}
                {% for g in genome_build_genes.genes %}
                    <a class="hover-link" href="{% url 'view_gene' g.pk %}">{{ g }}</a>
                {% endfor %}
            {% endlabelled %}
        {% endfor %}

        <table class="table">
            <thead>
                <tr>
                    <th>Version</th>
                    <th>Genome Build</th>
                    <th>Length</th>
                    <th>Alignment Gap</th>
                    <th>OK for Local HGVS Resolution</th>
                    <th>Method</th>
                </tr>
            </thead>
            <tbody>
                {% for tvd in transcript_version_details %}
                <tr>
                    <td style="width:80px">{% ifchanged tvd.version %}<a class="hover-link" href="{% url 'view_transcript_version' transcript.pk tvd.version %}">Version {{ tvd.version }}</a>{% endifchanged %}</td>
                    <td>{{ tvd.genome_build }}</td>
                    {% with tv=tvd.tv %}
                        {% if tv %}
                            <td class="num">{{ tv.length }}</td>
                            <td>{% if tv.alignment_gap %}{{ tv.cdna_match_diff }}{% else %}<span class="no-value">-</span>{% endif %}</td>
                            <td class="text-center">{{ tv.hgvs_ok | boolean }}</td>
                        {% else %}
                            <td colspan="3"><div class="no-value text-center">No local copy of transcript version</div></td>
                        {% endif %}
                    {% endwith %}
                     <td style="width:50%">
                        <div class="d-flex">
                        {% for description, resolution_order in tvd.hgvs_method.items %}
                            <div class="mx-1">
                                <label>{{ description }}</label>
                                {% for tv, method in resolution_order %}
                                    <div>{{ tv.accession }} using {{ method }}</div>
                                {% endfor %}
                            </div>
                        {% endfor %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock content %}