{% extends "uicore/page/base.html" %}
{% load crispy_forms_field %}
{% load ui_help %}
{% load ui_utils %}
{% load ui_menu_bars %}
{% block title %}Transcript: {{ transcript }}{% endblock title %}
{% block submenu %}{% menu_bar_data %}{% endblock %}

{% block content %}
    <div class="container">
        <h3>Transcript: {{ transcript }}</h3>

        {% if transcript.annotation_consortium == 'R' %}
            {% page_help 'genes/transcript_version_refseq' 'RefSeq Transcript Versions' %}
        {% elif transcript.annotation_consortium == 'E' %}
            {% page_help 'genes/transcript_version_ensembl' 'Ensembl Transcript Versions' %}
        {% endif %}

        <table class="table">
            <thead>
                <tr>
                    <th></th>
                    {% for genome_build in genome_builds %}
                        <th>{{ genome_build }} length</th>
                    {% endfor %}
                </tr>
                <tr>
                    <th>Gene</th>
                    {% for genes in build_genes %}
                        <td>
                            {% for g in genes %}
                                <a class="hover-link" href="{% url 'view_gene' g.pk %}">{{ g }}</a>
                            {% endfor %}
                        </td>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for version_data in transcript_versions %}
                    <tr>
                        {% for d, _ in version_data %}
                            {% if forloop.first %}
                                <td><a class="hover-link" href="{% url 'view_transcript_version' transcript.pk d %}">Version {{ identifier }}.{{ d }}</a></td>
                            {% else %}
                                <td>{{ d.length }}</td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <h3>HGVS Transcript resolution</h3>

        <table class="table">
            <thead>
                <tr>
                    <th></th>
                    {% for genome_build in genome_builds %}
                        <th style="text-align: center" colspan="3">{{ genome_build }}</th>
                    {% endfor %}
                </tr>

                <tr>
                    <th></th>
                {% for genome_build in genome_builds %}
                    <th>Alignment Gap</th>
                    <th>OK for local HGVS resolution</th>
                    <th>Method</th>
                {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for version_data in transcript_versions %}
                    <tr>
                        {% for d, hgvs_method in version_data %}
                            {% if forloop.first %}
                                <td><a class="hover-link" href="{% url 'view_transcript_version' transcript.pk d %}">Version {{ identifier }}.{{ d }}</a></td>
                            {% else %}
                                {% if d %}
                                    <td>
                                    {% if d.alignment_gap %}
                                        {{ d.cdna_match_diff }}
                                    {% endif %}
                                    </td>
                                    <td class="text-center">{{ d.hgvs_ok | boolean }}</td>
                                {% else %}
                                    <td colspan="2"></td>
                                 {% endif %}
                                <td>
                                    {% for tv, method in hgvs_method %}
                                        {{ tv.accession }} using {{ method }}
                                    {% endfor %}
                                </td>
                        {% endif %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock content %}