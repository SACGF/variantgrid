{% extends "uicore/page/base.html" %}
{% load ui_menu_bars %}
{% block submenu %}{% menu_bar_annotations %}{% endblock %}
{% load js_tags %}
{% load ui_tabs_builder %}
{% block title %}Annotation Version{% endblock title %}
{% block content %}
    <div class="container">
        {% load ui_help %}
        {% page_help page_id='annotation/annotation_versions_help' title='Annotation Versions'%}

        {% ui_register_tabs tab_set="annotation_versions" %}
        {% for build_name, av_data in annotation_versions.items %}
            {% ui_register_tab_embedded tab_set="annotation_versions" label=build_name %}
                <table class='table'>
                    <thead>
                        <tr>
                            <th>Version</th>
                            <th>Status</th>
                            <th>Annotation Date</th>
                            <th>Variant</th>
                            <th>Gene</th>
                            <th>ClinVar</th>
                            <th>Ontology</th>
                            <th>Human Protein Atlas</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% with latest=av_data.2 %}
                        {% for av in av_data.1 %}
                            <tr>
                                <td>{{ av.pk }}</td>
                                <td>
                                    {% if av.variant_annotation_version.active is False %}
                                        Inactive
                                    {% elif not av.is_valid %}
                                        Invalid
                                    {% else %}
                                        {% if av == latest %}
                                            Latest
                                        {% endif %}
                                    {% endif %}
                                </td>
                                <td>{% timestamp av.annotation_date %}</td>
                                <td>{{ av.variant_annotation_version|default_if_none:'' }}</td>
                                <td>{{ av.gene_annotation_version|default_if_none:'' }}</td>
                                <td>{{ av.clinvar_version|default_if_none:'' }}</td>
                                <td>{{ av.ontology_version|default_if_none:'' }}</td>
                                <td>{{ av.human_protein_atlas_version|default_if_none:'' }}</td>
                            </tr>
                        {% endfor %}
                    {% endwith %}
                    </tbody>
                </table>

                <div class='mt-4'>
                    <h4>Variant Annotation Versions</h4>

                    <a href="#vep-command-{{ build_name }}" class="toggle-link" data-toggle="collapse">Show VEP command</a>
                    <div id="vep-command-{{ build_name }}" class="collapse">
                        <pre class="border border-info p-2">{{ av_data.0 }}</pre>
                    </div>

                    <table id="vav-{{ build_name }}" data-datatable-url="{% url 'variant_annotation_version_datatable' build_name %}" class="sticky-header responsive"></table>
                </div>
            {% end_ui_register_tab_embedded %}
        {% endfor %}
        {% ui_render_tabs tab_set="annotation_versions" %}
    </div>
{% endblock content %}