{% load ui_utils %}
{% load classification_tags %}
<div id="ag-{{ allele_grouping.id }}">
    {% for grouping in groupings %}
        {% if not forloop.first %}<hr class="dashed"/>{% endif %}
        <div>
            <div class="allele-origin-box horizontal allele-origin-{{ grouping.allele_origin_grouping.allele_origin_bucket }}">
                <div class="allele-origin-text">{{ grouping.allele_origin_grouping.allele_origin_bucket_obj.label }}</div>
            </div>
            {% for classification_grouping in grouping.classification_groupings %}
                <div class="mt-2">
                {% if classification_grouping.classification_count > 10 %}
                    <div>Total of {{ classification_grouping.classification_count }} records from {{ classification_grouping.lab }}, showing most recent 10</div>
                {% endif %}
                {% for record in classification_grouping.classification_modifications|slice:"-10:" %}
                    <div class="mt-1">{% classification_quick record show_flags=True %}</div>
                    {% comment %}
                    <div class="mt-2 d-flex" style="align-items:center;position:relative;top:5px">
                        <a class="hover-link" style="font-weight:bold" href="{% url 'view_classification' record.classification_id %}">{{ record.classification.cr_lab_id}}</a>
                        {{ record.classification.allele_info.issue_icon|default_if_none:'' }}
                        <div class="flags d-inline-block" style="margin-left:12px" data-flags="{{ record.classification.flag_collection_id }}">...</div>
                    </div>
                    {% endcomment %}
                {% endfor %}
                </div>
            {% endfor %}
            {% if grouping.discordance_reports %}
                <div class="mt-4">
                {% for dr in grouping.discordance_reports %}
                    <div class="my-2">{% discordance_report dr %}</div>
                {% endfor %}
                </div>
            {% endif %}
        </div>
    {% endfor %}
</div>
<script>
    Flags.instance.init({userId: '{{user.id}}', forceRender: true, filter:"#ag-{{ allele_grouping.id }}", flagGroup:'classifications'});
</script>