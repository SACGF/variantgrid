{% extends "uicore/page/base.html" %}
{% load datatable_tags %}
{% load classification_tags %}
{% load ui_menu_bars %}
{% load ui_help %}
{% load ui_utils %}
{% block title %}Condition Matching{% endblock %}
{% block submenu %}{% menu_bar_classifications %}{% endblock submenu %}
{% block head %}

{% endblock head %}
{% block content %}
    <div class="container">
        <h3>Condition Match Testing</h3>
        {% page_help_embedded title='Condition Match Testing' %}
            <p>
            Help will go here for matching text to conditions
            </p>
        {% end_page_help_embedded %}

        <h4>Download</h4>
        <form method="POST" action="{% url 'condition_match_test_download' %}">
            {% csrf_token %}
            Run and download auto matching attempts. (Note doesn't apply the results, just produces them for download).<br/>
            This takes a while so it's recommended you limit your results.<br/>
            <div class="form-group">
                <label class="form-label">Condition Text Count</label>
                <div class="input-group">
                    <input type="number" name="row_count" value="10" />
                    <span class="input-group-append">
                        <input class="btn btn-primary" type="submit" value="Download" />
                    </span>
                </div>
            </div>
        </form>
        <hr/>

        <h4>Test Single Term</h4>
        <form method="GET">
            {% labelled label="Condition Text" %}<input class="form-control" name="condition_text" value="{{ condition_text | default_if_none:'' }}" />{% endlabelled %}
            {% labelled label="Gene Symbol" %}<input class="form-control" style="max-width:300px" name="gene_symbol" value="{{ gene_symbol | default_if_none:'' }}" />
                <span class="text-muted">(optional)</span>
            {% endlabelled %}
            <button class="btn btn-primary">Search</button>
        </form>

        <div class="text-muted">Note the following words will be ignored: "a", "an", "and", "for", "or", "the", "type"</div>

        {% if attempted %}
            {% if auto_matches %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Term</th>
                        <th>Score</th>
                    </tr>
                </thead>
                {% for auto_match in auto_matches %}
                    <tr>
                        <td width="30%">{{ auto_match.term.id }}<br/>
                            {{ auto_match.term.name }}
                            {% if auto_match.term.definition %}<br/><span class="text-muted wy-text-small">{{ auto_match.term.definition }}</span>{% endif %}
                        </td>
                        <td>
                            <div class="row mb-1">
                                <div class="col-1 text-right text-monospace border-bottom" style="font-weight: bold">
                                    {{ auto_match.score | floatformat:0 }}
                                </div>
                                <div class="col-11"></div>
                            </div>
                            {% for part in auto_match.scores %}
                                <div class="row mb-1">
                                    <div class="col-1 text-right text-monospace">{{ part.score | floatformat:0 }}</div>
                                    <div class="col-11">{{ part.name }} : <span class="text-secondary">{{ part.note }} - <span style="font-size:small">{{ part.percent | floatformat:0 }}% of {{ part.max | floatformat:0 }}</span></span></div>
                                </div>
                            {% endfor %}
                        </td>
                    </tr>
                {% endfor %}
            </table>
            {% else %}
                <span class="no-results">No Results</span>
            {% endif %}
        {% endif %}
    </div>
{% endblock %}