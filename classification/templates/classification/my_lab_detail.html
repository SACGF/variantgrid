{% load classification_tags %}
{% load english_tags %}
{% load ui_utils %}
{% load ui_tabs_builder %}

{% load js_tags %}
{% load static %}

<script type="text/javascript" src="{% static 'js/lib/plotly-latest.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/plotly_helper.js' %}"></script>

<script>
    var PATHOGENIC_COLORS = ['#cccccc', // VUS
                            '#7777ff', // Benign
                            '#aaaaff', // Likely benign
                            '#ffaaaa', // Likely pathogenic
                            '#ff7777', // pathogenic
                            ];

    var PATHOGENIC_LABELS = ['VUS',
                            'Benign',
                            'Likely Benign',
                            'Likely Pathogenic',
                            'Pathogenic',
    ];

    var PATHOGENIC_DICT = dictFromLabelsAndValues(PATHOGENIC_LABELS, PATHOGENIC_COLORS);

    function plotGeneVusCount(selector, title, width, height) {
        {% if vus_present %}
        let gene_vus_json = {{ gene_vus_count | jsonify }};
        for (var i=0 ; i < gene_vus_json.length ; ++i) {
                gene_vus_json[i]["marker"] = {color : PATHOGENIC_COLORS[i]}}
        let layout = {
            title: "Germline Classifications per Gene",
            width: 1200,
            height: 600,
            barmode: 'stack',
            updatemenus: [{
                buttons: [
                    {
                        method: 'restyle',
                        label: 'Show All Classifications',
                        args: [{visible: true}]
                    },
                    {
                        method: 'restyle',
                        label: 'Show VUS Counts',
                        args: [{'visible': 'legendonly'}, [1, 2, 3, 4]]
                    }
                ],
                direction: 'left',
                showactive: 'true',
                type: 'buttons',
                x: 0.6,
                y: -0.1
            }]
        }
        console.log(selector);
        console.log(gene_vus_json);
        console.log(layout);
        Plotly.newPlot(selector, gene_vus_json, layout)
        {% endif %}
    }


    function plotUniqueVUSCount(selector, title, width, height) {
        {% if vus_present %}
            let unique_vus_json = {{ unique_vus_count | jsonify }};
            unique_vus_json[0]['marker'] = {"color": '#dddddd'}
            let layout = {
                title: "Unique VUS per Gene",
                width: 1200,
                height: 600}
            Plotly.newPlot(selector, unique_vus_json, layout)
        {% endif %}
    }

    $(document).ready(() => {
        plotGeneClinSigCount("vus-per-gene", "VUS per Genes");
        plotUniqueVUSCount("unique-vus-per-gene", "Unique VUS per Gene");
    });
</script>

<div class="my-4">

    <p>{{ gene_vus_count | jsonify }}</p>

    <div class="row">
        <div id='vus-per-gene'></div>
    </div>

    <a href="{% url 'my_lab_download' lab_picker_data.selection %}" class="download-link" download>Download Classification per Gene Data</a>

    <div class="row">
        <div id="unique-vus-per-gene"></div>
    </div>

    <a href="{% url 'my_lab_download' lab_picker_data.selection %}?allele_level=true" class="download-link" download>Download Unique VUS per Gene Data</a>

</div>