{% load ui_utils %}
{% load crispy_forms_tags %}
{% load user_tags %}
{% load classification_tags %}
{% if mode == "inline" %}
    INLINE
{% else %}
    <form data-toggle="ajax-form" method="POST" action="{% url 'triage' classification_grouping.pk value_type %}?edit=true&mode={{ mode }}">
    <div class="card-header">Triage</div>
    <div class="card-body">
        {% include "uicore/messages/messages.html" %}
        Triage stuff will go here
        {% labelled label="Other Submissions" %}
            {% for alternative_grouping in alternative_groupings %}
                <div class="my-1">{% classification_quick alternative_grouping.latest_classification_modification show_category=True show_share_level=False %}</div>
                {% if not forloop.last %}<hr/>{% endif %}
            {% endfor %}
        {% endlabelled %}
        <hr/>
        {% labelled label="Your Submission" %}
            <div class="y-1">{% classification_quick classification_grouping.latest_classification_modification show_category=True show_share_level=False %}</div>
        {% endlabelled %}
{#        {% labelled label="New Value" %}#}
{#            <select class="form-control" name="new-value" id="triage-new-value">#}
{#                <option value="no-chance">No Change</option>#}
{#                {% for option in evidence_key.virtual_options %}#}
{#                    <option value="{{ option.value }}">{{ option.label }}</option>#}
{#                {% endfor %}#}
{#            </select>#}
{#        {% endlabelled %}#}
        {% if form %}
        {% crispy form form_helper.horizontal %}
        {% endif %}

        {% labelled label="Comment" %}
            <textarea class="form-control" rows="3" id="comment" name="comment"></textarea>
        {% endlabelled %}
    </div>
    <div class="card-footer">
        <input type="submit" class="btn btn-primary" value="Submit">
    </div>
    </form>

    {% comment %}
    <div class="card-header">{{ triage.lab }} {% admin_link triage %}</div>
    {% if form %}
        <style>
            .triage-form input[value="P"] + label {
                color: #888 !important;
            }
        </style>
        <form data-toggle="ajax-form" method="POST" action="{% url 'discordance_report_triage_detail' triage.pk %}?edit=true&mode={{ mode }}">
            <div class="card-body">
                {% labelled label="Editing By" %}{% user user size="tiny" %}{% endlabelled %}
                <div class="triage-form">
                {% crispy form form_helper.horizontal %}
                </div>
            </div>
            <div class="card-footer">
                <input type="submit" class="btn btn-primary" />
            </div>
        </form>
    {% else %}
        {% load ui_utils %}
        {% load js_tags %}
        {% load crispy_forms_tags %}
        <div class="card-body">
            {% labelled label="Triage Status" %}
                {% if triage.triage_status == "P" %}<span class="no-value">Pending</span>{% else %}
                {{ triage.get_triage_status_display }}
                {% endif %}
            {% endlabelled %}
            {% if triage.triage_date %}
                {% labelled label="Triage Date" %}{{ triage.triage_date | date:'Y-m-d' }}{% endlabelled %}
            {% endif %}
            {% if triage.user %}
                {% labelled label="Last Update By" %}{% user triage.user size="tiny" %}{% endlabelled %}
            {% endif %}
            {% if triage.note %}
                {% labelled label="Note" %}{{ triage.note }}{% endlabelled %}
            {% endif %}
            <div class="container">{% include "uicore/messages/messages.html" %}</div>
            {% if saved %}
                Warning this is duplicated in discordance_report.html
                <div data-replace="#discordance-report-discussion">
                    {% if next_step == "D" %}
                        <div class="card">
                            <div class="card-header">Discussion</div>
                            <div class="card-body">
                                <div class="no-value">This Discordance Report has not yet been discussed.</div>
                            </div>
                            <div class="card-footer">
                                <a class="mt-2 btn btn-primary" href="{% url 'discordance_report_review' report.pk %}">Start Discordance Discussion</a>
                            </div>
                        </div>
                    {% else %}
                        <div class="no-value">This discordance isn't marked as ready for discussion - see triages. <a class="hover-link" href="{% url 'discordance_report_review' report.pk %}">Click here to discuss anyway.</a></div>
                    {% endif %}
                </div>
            {% endif %}
        </div>
        {% if not read_only %}
            {% if_user_can_edit triage %}
                <div class="card-footer">
                    <a class="btn btn-primary" data-toggle="embed-content" href="{% url 'discordance_report_triage_detail' triage.pk %}?edit=true">Edit</a>
                </div>
            {% end_if_user_can_edit %}
        {% endif %}
    {% endif %}
    {% endcomment %}
{% endif %}