{% extends "uicore/page/base.html" %}
{% load datatable_tags %}
{% load classification_tags %}
{% load ui_menu_bars %}
{% load ui_help %}
{% block title %}Condition Aliases{% endblock %}
{% block submenu %}{% menu_bar_classifications %}{% endblock submenu %}
{% block head %}
    <script>
        $(document).ready(() => {
            {% datatable_definition table_config=datatable_config table_id='condition-alias-datatable' url='condition_aliases_datatables' responsive=True %}
        });
        function renderId(data, type, row) {
            // TODO geneate urls
            let elem = $('<a/>', {href: `/classification/condition_alias/${data}`, text: `${data}`, class:'id-link'});
            return elem.prop('outerHTML');
        };
        function mondo_list(data, type, row) {
            let mondos = data.aliases;
            if (mondos) {
                let join_mode = data.join_mode == 'A' ? 'and' : 'or';
                let dom = $('<div>');
                let first = true;
                for (let mondo of mondos) {
                    if (!first) {
                        dom.append(` ${join_mode} `);
                    }
                    first = false;
                    let mondo_id = mondo.id;
                    let mondo_name = mondo.name || "?";
                    let mondo_num = mondo_id.substring("MONDO:".length);
                    let href = `https://ontology.dev.data.humancellatlas.org/ontologies/mondo/terms?iri=http%3A%2F%2Fpurl.obolibrary.org%2Fobo%2FMONDO_${mondo_num}`
                    let aDom = $('<a>', {class: 'hover-link external-link', target:'_blank', text: mondo_id, href: href, title:mondo_name, 'data-toggle':'tooltip'});
                    dom.append(aDom);
                }
                return dom.prop('outerHTML');
            } else {
                return '';
            }
        }
    </script>
    <style>
        a.id-link {
            min-width: 30px;
            padding-top: 8px;
            padding-bottom: 8px;
            display: inline-block;
            text-align: center;
        }
    </style>
{% endblock head %}
{% block content %}
    <div class="container">
        <h3>Condition Aliases</h3>
        {% page_help_embedded title='Condition Aliases' %}
            <p>
            For submission to ClinVar, we require that all conditions be assigned an ontology ID.<br/>
            Records that simply have text in their condition can either be re-uploaded with references to MONDO, HPO, OMIM etc<br/>
            or Condition Aliases can be used to associate that text to a MONDO term.
            </p>
            <p>
            Below is a list of lab, gene symbol and condition text that was provided with no ontology ID.
            </p>
            <p>
            By navigating to a row, you can assign a MONDO identifier to one of the combinations.
            </p>
            <p>
            Condition Alias records will have one of the following statuses:
            <ul class="list-group">
                <li class="list-group-item dt-status"><span class="val-P">Pending</span> : This record requires manual interaction to resolve it to MONDO identifiers</li>
                <li class="list-group-item dt-status"><span class="val-R">Resolved</span> : This record has been manually resolved to a MONDO identifier</li>
                <li class="list-group-item dt-status"><span class="val-A">Auto-Resolved</span> : This record has been automatically resolved to a MONDO identifier</li>
                <li class="list-group-item dt-status"><span class="val-U">Unmatchable</span> : This text can't be consistently matched to any MONDO term</li>
            </ul>
            </p>
        {% end_page_help_embedded %}
        {% datatable datatable_config 'condition-alias-datatable' class_name='condition-alias-datatable responsive sticky-header' %}
    </div>
{% endblock %}