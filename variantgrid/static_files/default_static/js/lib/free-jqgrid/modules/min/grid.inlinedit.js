!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],e):"object"==typeof module&&module.exports?module.exports=function(t,i){return t||(t=window),void 0===i&&(i="undefined"!=typeof window?require("jquery"):require("jquery")(t)),require("./grid.base"),require("./jquery.fmatter"),require("./grid.common"),e(i),i}:e(jQuery)}(function(e){"use strict";var t=e.jgrid,i=t.fullBoolFeedback,a=t.hasOneFromClasses,r=e.fn.jqGrid,o=function(e){return r.getGuiStyles.call(this,"states."+e)},n=function(i){var a=e.makeArray(arguments).slice(1);return a.unshift(""),a.unshift("Inline"),a.unshift(i),t.feedback.apply(this,a)};t.inlineEdit=t.inlineEdit||{},t.extend({editRow:function(a,r,d,l,s,c,u,f,m,v){var p={},w=e.makeArray(arguments).slice(1);return"object"===e.type(w[0])?p=w[0]:(void 0!==r&&(p.keys=r),e.isFunction(d)&&(p.oneditfunc=d),e.isFunction(l)&&(p.successfunc=l),void 0!==s&&(p.url=s),null!=c&&(p.extraparam=c),e.isFunction(u)&&(p.aftersavefunc=u),e.isFunction(f)&&(p.errorfunc=f),e.isFunction(m)&&(p.afterrestorefunc=m),e.isFunction(v)&&(p.beforeEditRow=v)),this.each(function(){var r=this,d=e(r),l=r.p,s=0,c=null,u={},f={},m=l.colModel,v=l.prmNames;if(r.grid){var w=e.extend(!0,{keys:!1,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeEditRow:null,focusField:!0},t.inlineEdit,l.inlineEditing||{},p),h=d.jqGrid("getInd",a,!0),R=w.focusField,g="object"==typeof R&&null!=R?e(R.target||R).closest("tr.jqgrow>td")[0]:null;if(!1!==h&&(w.extraparam[v.oper]===v.addoper||n.call(r,w,"beforeEditRow",w,a))&&"0"===(e(h).attr("editable")||"0")&&!e(h).hasClass("not-editable-row")){var j=t.detectRowEditing.call(r,a);if(null!=j&&"cellEditing"===j.mode){var x=j.savedRow,q=r.rows[x.id],b=o.call(r,"select");d.jqGrid("restoreCell",x.id,x.ic),e(q.cells[x.ic]).removeClass("edit-cell "+b),e(q).addClass(b).attr({"aria-selected":"true",tabindex:"0"})}if(t.enumEditableCells.call(r,h,e(h).hasClass("jqgrid-new-row")?"add":"edit",function(i){var o,n,d,m=i.cm,v=e(i.dataElement),p=i.dataWidth,w=m.name,h=m.edittype,R=i.iCol,g=m.editoptions||{};if(f[w]=i.editable,"hidden"!==i.editable){try{o=e.unformat.call(this,i.td,{rowId:a,colModel:m},R)}catch(e){o="textarea"===h?v.text():v.html()}u[w]=o,v.html(""),n=e.extend({},g,{id:a+"_"+w,name:w,rowId:a,mode:i.mode,cm:m,iCol:R}),("&nbsp;"===o||"&#160;"===o||1===o.length&&160===o.charCodeAt(0))&&(o=""),d=t.createEl.call(r,h,n,o,!0,e.extend({},t.ajaxOptions,l.ajaxSelectOptions||{})),e(d).addClass("editable"),v.append(d),p&&e(d).width(i.dataWidth),t.bindEv.call(r,d,n),"select"===h&&!0===g.multiple&&void 0===g.dataUrl&&t.msie&&e(d).width(e(d).width()),null===c&&(c=R),s++}}),s>0){if(u.id=a,l.savedRow.push(u),l.editingInfo[a]={mode:"inlineEditing",savedRow:u,editable:f},e(h).attr("editable","1"),R&&("number"==typeof R&&parseInt(R,10)<=m.length?c=R:"string"==typeof R?c=l.iColByName[R]:null!=g&&(c=g.cellIndex),setTimeout(function(){var t=d.jqGrid("getNumberOfFrozenColumns"),i=function(e){return l.frozenColumns&&t>0&&c<t?r.grid.fbRows[h.rowIndex].cells[e]:h.cells[e]},a=function(t){return e(t).find("input,textarea,select,button,object,*[tabindex]").filter(":input:visible:not(:disabled)")},o=function(){return a(l.frozenColumns&&t>0?r.grid.fbRows[h.rowIndex]:h).first()},n=a(i(c));n.length>0?n.first().focus():"number"==typeof w.defaultFocusField||"string"==typeof w.defaultFocusField?(0===(n=a(i("number"==typeof w.defaultFocusField?w.defaultFocusField:l.iColByName[w.defaultFocusField]))).length&&(n=o()),n.first().focus()):o().focus()},0)),!0===w.keys){var y=e(h);l.frozenColumns&&(y=y.add(r.grid.fbRows[h.rowIndex])),y.on("keydown",function(e){return 27===e.keyCode?(d.jqGrid("restoreRow",a,w.afterrestorefunc),!1):13===e.keyCode?"TEXTAREA"===e.target.tagName||(d.jqGrid("saveRow",a,w),!1):void 0})}i.call(r,w.oneditfunc,"jqGridInlineEditRow",a,w)}}}})},saveRow:function(a,r,d,l,s,c,u,f){var m,v=e.makeArray(arguments).slice(1),p={},w=this[0],h=e(w),R=null!=w?w.p:null,g=t.info_dialog,j=e.isFunction,x=null!=t.defaults&&j(t.defaults.fatalError)?t.defaults.fatalError:alert;if(w.grid&&null!=R){"object"===e.type(v[0])?p=v[0]:(j(r)&&(p.successfunc=r),void 0!==d&&(p.url=d),void 0!==l&&(p.extraparam=l),j(s)&&(p.aftersavefunc=s),j(c)&&(p.errorfunc=c),j(u)&&(p.afterrestorefunc=u),j(f)&&(p.beforeSaveRow=f));var q=function(e){return h.jqGrid("getGridRes",e)};p=e.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeSaveRow:null,ajaxSaveOptions:{},serializeSaveData:null,mtype:"POST",saveui:"enable",savetext:q("defaults.savetext")||"Saving..."},t.inlineEdit,R.inlineEditing||{},p);var b,y,I,G,E,C,P,S,D={},k={},F={},A=h.jqGrid("getInd",a,!0),_=e(A),O=R.prmNames,T=q("errors.errcap"),B=q("edit.bClose"),N=function(i,a){try{var r=t.getRelativeRect.call(w,a);g.call(w,T,i,B,{top:r.top,left:r.left+e(w).closest(".ui-jqgrid").offset().left})}catch(e){x(i)}};if(!1!==A&&(m=p.extraparam[O.oper]===O.addoper?"add":"edit",n.call(w,p,"beforeSaveRow",p,a,m)&&(b=_.attr("editable"),p.url=p.url||R.editurl,P="clientArray"!==p.url,"1"===b))){if(C=e.jgrid.detectRowEditing.call(w,a),t.enumEditableCells.call(w,A,_.hasClass("jqgrid-new-row")?"add":"edit",function(i){var a=i.cm,r=a.formatter,o=a.editoptions||{},n=a.formatoptions||{},d={},l=t.getEditedValue.call(w,e(i.dataElement),a,d,i.editable);if("select"===a.edittype&&"select"!==a.formatter&&(k[a.name]=d.text),null!=(E=t.checkValues.call(w,l,i.iCol,void 0,void 0,e.extend(i,{oldValue:null!=C?C.savedRow[a.name]:null,newValue:l,oldRowData:null!=C?C.savedRow:null})))&&!1===E[0])return S=!0,N(E[1],i.td),!1;"date"===r&&!0!==n.sendFormatted&&(l=e.unformat.date.call(w,l,a)),P&&!0===o.NullIfEmpty&&""===l&&(l="null"),D[a.name]=l}),S)return;var z;O=R.prmNames,z=!1===R.keyName?O.id:R.keyName,D&&(D[O.oper]=O.editoper,void 0!==D[z]&&""!==D[z]||(D[z]=t.stripPref(R.idPrefix,a)),D=e.extend({},D,R.inlineData||{},p.extraparam));var V={options:p,rowid:a,tr:A,iRow:A.rowIndex,savedRow:C.savedRow,newData:D,mode:m};if(!n.call(w,p,"saveRowValidation",V))return void(V.errorText&&N(V.errorText,A));if(P)h.jqGrid("progressBar",{method:"show",loadtype:p.saveui,htmlcontent:p.savetext}),(F=e.extend({},D,F))[z]=t.stripPref(R.idPrefix,F[z]),R.autoEncodeOnEdit&&e.each(F,function(e,i){j(i)||(F[e]=t.oldEncodePostedData(i))}),A.id===R.idPrefix+F[z]||null==O.idold||F.hasOwnProperty(O.idold)||(F[O.idold]=t.stripPref(R.idPrefix,A.id)),e.ajax(e.extend({url:j(p.url)?p.url.call(w,F[z],m,F,p):p.url,data:t.serializeFeedback.call(w,j(p.serializeSaveData)?p.serializeSaveData:R.serializeRowData,"jqGridInlineSerializeSaveData",F),type:j(p.mtype)?p.mtype.call(w,m,p,F[z],F):p.mtype,complete:function(r,o){if(h.jqGrid("progressBar",{method:"hide",loadtype:p.saveui}),(r.status<300||304===r.status)&&(0!==r.status||4!==r.readyState)){var n,d,l;if(null!=(d=h.triggerHandler("jqGridInlineSuccessSaveRow",[r,a,p,m,F]))&&!0!==d||(d=[!0,D]),d[0]&&j(p.successfunc)&&(d=p.successfunc.call(w,r,a,p,m,F)),e.isArray(d)?(n=d[0],D=d[1]||D):n=d,!0===n){for(R.autoEncodeOnEdit&&e.each(D,function(e,i){D[e]=t.oldDecodePostedData(i)}),D=e.extend({},D,k),h.jqGrid("setRowData",a,D),_.attr("editable","0"),l=0;l<R.savedRow.length;l++)if(String(R.savedRow[l].id)===String(a)){I=l;break}I>=0&&(R.savedRow.splice(I,1),delete R.editingInfo[a]),i.call(w,p.aftersavefunc,"jqGridInlineAfterSaveRow",a,r,D,p),null!=d[2]?h.jqGrid("changeRowid",a,R.idPrefix+d[2]):A.id!==R.idPrefix+D[z]&&h.jqGrid("changeRowid",A.id,R.idPrefix+D[z]),_.removeClass("jqgrid-new-row").off("keydown")}else i.call(w,p.errorfunc,"jqGridInlineErrorSaveRow",a,r,o,null,p),!0===p.restoreAfterError&&h.jqGrid("restoreRow",a,p.afterrestorefunc)}},error:function(e,t,i){if(h.triggerHandler("jqGridInlineErrorSaveRow",[a,e,t,i,p]),j(p.errorfunc))p.errorfunc.call(w,a,e,t,i);else{var r=e.responseText||e.statusText;try{g.call(w,T,'<div class="'+o.call(w,"error")+'">'+r+"</div>",B,{buttonalign:"right"})}catch(e){x(r)}}!0===p.restoreAfterError&&h.jqGrid("restoreRow",a,p.afterrestorefunc)}},t.ajaxOptions,R.ajaxRowOptions,p.ajaxSaveOptions||{}));else{for(D=e.extend({},D,k),G=h.jqGrid("setRowData",a,D),_.attr("editable","0"),y=0;y<R.savedRow.length;y++)if(String(R.savedRow[y].id)===String(a)){I=y;break}I>=0&&(R.savedRow.splice(I,1),delete R.editingInfo[a]),i.call(w,p.aftersavefunc,"jqGridInlineAfterSaveRow",a,G,D,p),_.removeClass("jqgrid-new-row").off("keydown"),A.id!==R.idPrefix+D[z]&&h.jqGrid("changeRowid",A.id,R.idPrefix+D[z])}}}},restoreRow:function(a,r){var o=e.makeArray(arguments).slice(1),d={};return"object"===e.type(o[0])?d=o[0]:e.isFunction(r)&&(d.afterrestorefunc=r),this.each(function(){var r,o=this,l=e(o),s=o.p,c=-1,u={};if(o.grid){var f=e.extend(!0,{},t.inlineEdit,s.inlineEditing||{},d),m=l.jqGrid("getInd",a,!0);if(!1!==m&&n.call(o,f,"beforeCancelRow",f,a)){for(r=0;r<s.savedRow.length;r++)if(String(s.savedRow[r].id)===String(a)){c=r;break}if(c>=0){if(e.isFunction(e.fn.datepicker))try{e("input.hasDatepicker","#"+t.jqID(m.id)).datepicker("hide")}catch(e){}e.each(s.colModel,function(){var t=this.name;s.savedRow[c].hasOwnProperty(t)&&(u[t]=s.savedRow[c][t],!this.formatter||"date"!==this.formatter||null!=this.formatoptions&&!0===this.formatoptions.sendFormatted||(u[t]=e.unformat.date.call(o,u[t],this)))}),l.jqGrid("setRowData",a,u),e(m).attr("editable","0").off("keydown"),s.savedRow.splice(c,1),delete s.editingInfo[a],e("#"+t.jqID(a),o).hasClass("jqgrid-new-row")&&setTimeout(function(){l.jqGrid("delRowData",a),l.jqGrid("showAddEditButtons",!1)},0)}i.call(o,f.afterrestorefunc,"jqGridInlineAfterRestoreRow",a)}}})},addRow:function(i){return this.each(function(){if(this.grid){var a=this,r=e(a),o=a.p,d=e.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,beforeAddRow:null,addRowParams:{extraparam:{}}},t.inlineEdit,o.inlineEditing||{},i||{});if(n.call(a,d,"beforeAddRow",d.addRowParams))if(d.rowID=e.isFunction(d.rowID)?d.rowID.call(a,d):null!=d.rowID?d.rowID:t.randId(),!0===d.useDefValues&&e(o.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var t=this.editoptions.defaultValue;d.initdata[this.name]=e.isFunction(t)?t.call(a,d):t}}),d.rowID=o.idPrefix+d.rowID,r.jqGrid("addRowData",d.rowID,d.initdata,d.position),e("#"+t.jqID(d.rowID),a).addClass("jqgrid-new-row"),d.useFormatter)e("#"+t.jqID(d.rowID)+" .ui-inline-edit",a).click();else{var l=o.prmNames,s=l.oper;d.addRowParams.extraparam[s]=l.addoper,r.jqGrid("editRow",d.rowID,d.addRowParams),r.jqGrid("setSelection",d.rowID)}}})},inlineNav:function(i,r){return"object"==typeof i&&(r=i,i=void 0),this.each(function(){var n=this,d=e(n),l=n.p;if(this.grid&&null!=l){var s,c=i===l.toppager?l.idSel+"_top":l.idSel,u=i===l.toppager?l.id+"_top":l.id,f=o.call(n,"disabled"),m=e.extend(!0,{edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",save:!0,saveicon:"ui-icon-disk",cancel:!0,cancelicon:"ui-icon-cancel",commonIconClass:"ui-icon",iconsOverText:!1,addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:!0},d.jqGrid("getGridRes","nav"),t.nav||{},l.navOptions||{},t.inlineNav||{},l.inlineNavOptions||{},r||{}),v=function(){n.modalAlert()};if(void 0===i)if(l.pager){if(d.jqGrid("inlineNav",l.pager,m),!l.toppager)return;i=l.toppager,c=l.idSel+"_top",u=l.id+"_top"}else l.toppager&&(i=l.toppager,c=l.idSel+"_top",u=l.id+"_top");if(void 0!==i&&!((s=e(i)).length<=0)){if(s.find(".navtable").length<=0&&d.jqGrid("navGrid",i,{add:!1,edit:!1,del:!1,search:!1,refresh:!1,view:!1}),l._inlinenav=!0,!0===m.addParams.useFormatter){var p,w,h,R=l.colModel;for(p=0;p<R.length;p++)if(R[p].formatter&&"actions"===R[p].formatter){R[p].formatoptions&&(w={keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},h=e.extend(w,R[p].formatoptions),m.addParams.addRowParams={keys:h.keys,oneditfunc:h.onEdit,successfunc:h.onSuccess,url:h.url,extraparam:h.extraparam,aftersavefunc:h.afterSave,errorfunc:h.onError,afterrestorefunc:h.afterRestore});break}}m.add&&d.jqGrid("navButtonAdd",i,{caption:m.addtext,title:m.addtitle,commonIconClass:m.commonIconClass,buttonicon:m.addicon,iconsOverText:m.iconsOverText,id:u+"_iladd",onClickButton:function(){a(this,f)||d.jqGrid("addRow",m.addParams)}}),m.edit&&d.jqGrid("navButtonAdd",i,{caption:m.edittext,title:m.edittitle,commonIconClass:m.commonIconClass,buttonicon:m.editicon,iconsOverText:m.iconsOverText,id:u+"_iledit",onClickButton:function(){if(!a(this,f)){var e=l.selrow;e?d.jqGrid("editRow",e,m.editParams):v()}}}),m.save&&(d.jqGrid("navButtonAdd",i,{caption:m.savetext,title:m.savetitle,commonIconClass:m.commonIconClass,buttonicon:m.saveicon,iconsOverText:m.iconsOverText,id:u+"_ilsave",onClickButton:function(){if(!a(this,f)){var i=l.savedRow[0].id;if(i){var r=l.prmNames,o=r.oper,s=m.editParams;e("#"+t.jqID(i),n).hasClass("jqgrid-new-row")?(m.addParams.addRowParams.extraparam[o]=r.addoper,s=m.addParams.addRowParams):(m.editParams.extraparam||(m.editParams.extraparam={}),m.editParams.extraparam[o]=r.editoper),d.jqGrid("saveRow",i,s)}else v()}}}),e(c+"_ilsave").addClass(f)),m.cancel&&(d.jqGrid("navButtonAdd",i,{caption:m.canceltext,title:m.canceltitle,commonIconClass:m.commonIconClass,buttonicon:m.cancelicon,iconsOverText:m.iconsOverText,id:u+"_ilcancel",onClickButton:function(){if(!a(this,f)){var i=l.savedRow[0].id,r=m.editParams;i?(e("#"+t.jqID(i),n).hasClass("jqgrid-new-row")&&(r=m.addParams.addRowParams),d.jqGrid("restoreRow",i,r)):v()}}}),e(c+"_ilcancel").addClass(f)),!0===m.restoreAfterSelect&&d.on("jqGridSelectRow",function(e,t){if(l.savedRow.length>0&&!0===l._inlinenav){var i=l.savedRow[0].id;t!==i&&"number"!=typeof i&&d.jqGrid("restoreRow",i,m.editParams)}}),d.on("jqGridInlineAfterRestoreRow jqGridInlineAfterSaveRow",function(){d.jqGrid("showAddEditButtons",!1)}),d.on("jqGridInlineEditRow",function(e,t){d.jqGrid("showAddEditButtons",!0,t)})}}})},showAddEditButtons:function(t){return this.each(function(){var i=this;if(i.grid){var a=i.p,r=a.idSel,n=o.call(i,"disabled"),d=r+"_ilsave,"+r+"_ilcancel"+(a.toppager?","+r+"_top_ilsave,"+r+"_top_ilcancel":""),l=r+"_iladd,"+r+"_iledit"+(a.toppager?","+r+"_top_iladd,"+r+"_top_iledit":"");e(t?l:d).addClass(n),e(t?d:l).removeClass(n)}})}})});
//# sourceMappingURL=grid.inlinedit.js.map