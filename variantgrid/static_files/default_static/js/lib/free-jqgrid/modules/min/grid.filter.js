!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],function(r){return t(r,e)}):"object"==typeof module&&module.exports?module.exports=function(e,r){return e||(e=window),void 0===r&&(r="undefined"!=typeof window?require("jquery"):require("jquery")(e)),require("./grid.base"),require("./grid.common"),t(r,e),r}:t(jQuery,e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";var r=e.jgrid;e.fn.jqFilter=function(n){if("string"==typeof n){var o=e.fn.jqFilter[n];if(!o)throw"jqFilter - No such method: "+n;var a=e.makeArray(arguments).slice(1);return o.apply(this,a)}var s=e.extend(!0,{filter:null,columns:[],onChange:null,afterRedraw:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,sopt:null,ops:[],operands:null,numopts:["eq","ne","lt","le","gt","ge","nu","nn","in","ni"],stropts:["eq","ne","bw","bn","ew","en","cn","nc","nu","nn","in","ni"],strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,direction:"ltr"},r.filter,n||{});return this.each(function(){if(!this.filter){this.p=s,null!==s.filter&&void 0!==s.filter||(s.filter={groupOp:s.groupOps[0].op,rules:[],groups:[]});var n,o,a=s.columns.length,i=/msie/i.test(navigator.userAgent)&&!t.opera,p=e.isFunction,l=null!=r.defaults&&p(r.defaults.fatalError)?r.defaults.fatalError:alert,u=function(){return e("#"+r.jqID(s.id))[0]||null},c=function(t,r){return e(u()).jqGrid("getGuiStyles",t,r||"")},d=function(t){return e(u()).jqGrid("getGridRes","search."+t)},h=function(e){var t=u(),r=t.p.iColByName[e];return void 0!==r?{cm:t.p.colModel[r],iCol:r}:void 0!==(r=t.p.iPropByName[e])?{cm:t.p.additionalProperties[r],iCol:r,isAddProp:!0}:{cm:null,iCol:-1}},f=c("states.error"),g=c("dialog.content");if(s.initFilter=e.extend(!0,{},s.filter),a){for(n=0;n<a;n++)(o=s.columns[n]).stype?o.inputtype=o.stype:o.inputtype||(o.inputtype="text"),o.sorttype?o.searchtype=o.sorttype:o.searchtype||(o.searchtype="string"),void 0===o.hidden&&(o.hidden=!1),o.label||(o.label=o.name),o.cmName=o.name,o.index&&(o.name=o.index),o.hasOwnProperty("searchoptions")||(o.searchoptions={}),o.hasOwnProperty("searchrules")||(o.searchrules={});s.showQuery&&e(this).append("<table class='queryresult "+g+"' style='display:block;max-width:440px;border:0px none;' dir='"+s.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");var m=function(e,t){var n=[!0,""],o=u();if(p(t.searchrules))n=t.searchrules.call(o,e,t);else if(r&&r.checkValues)try{n=r.checkValues.call(o,e,-1,t.searchrules,t.label)}catch(e){}n&&n.length&&!1===n[0]&&(s.error=!n[0],s.errmsg=n[1])};this.onchange=function(){return s.error=!1,s.errmsg="",!!p(s.onChange)&&s.onChange.call(u(),s,this)},this.reDraw=function(){e("table.group:first",this).remove();var t=this.createTableForGroup(s.filter,null);e(this).append(t),p(s.afterRedraw)&&s.afterRedraw.call(u(),s,this)},this.createTableForGroup=function(t,r){var n,o=this,a=e("<table class='"+c("searchDialog.operationGroup","group")+"' style='border:0px none;'><tbody></tbody></table>"),i="left";"rtl"===s.direction&&(i="right",a.attr("dir","rtl")),null===r&&a.append("<tr class='error' style='display:none;'><th colspan='5' class='"+f+"' align='"+i+"'></th></tr>");var p=e("<tr></tr>");a.append(p);var l=e("<th colspan='5' align='"+i+"'></th>");if(p.append(l),!0===s.ruleButtons){var u=e("<select class='"+c("searchDialog.operationSelect","opsel")+"'></select>");l.append(u);var h,g="";for(n=0;n<s.groupOps.length;n++)h=t.groupOp===o.p.groupOps[n].op?" selected='selected'":"",g+="<option value='"+o.p.groupOps[n].op+"'"+h+">"+o.p.groupOps[n].text+"</option>";u.append(g).on("change",function(){t.groupOp=e(u).val(),o.onchange()})}var m="<span></span>";if(s.groupButton&&(m=e("<input type='button' value='+ {}' title='"+d("addGroupTitle")+"' class='"+c("searchDialog.addGroupButton","add-group")+"'/>")).on("click",function(){return void 0===t.groups&&(t.groups=[]),t.groups.push({groupOp:s.groupOps[0].op,rules:[],groups:[]}),o.reDraw(),o.onchange(),!1}),l.append(m),!0===s.ruleButtons){var v,y=e("<input type='button' value='+' title='"+d("addRuleTitle")+"' class='"+c("searchDialog.addRuleButton","add-rule ui-add")+"'/>");y.on("click",function(){var r,a;for(void 0===t.rules&&(t.rules=[]),n=0;n<o.p.columns.length;n++)if(r=void 0===o.p.columns[n].search||o.p.columns[n].search,a=!0===o.p.columns[n].hidden,!0===o.p.columns[n].searchoptions.searchhidden&&r||r&&!a){v=o.p.columns[n];break}var s;return s=v.searchoptions.sopt?v.searchoptions.sopt:o.p.sopt?o.p.sopt:-1!==e.inArray(v.searchtype,o.p.strarr)?o.p.stropts:o.p.numopts,t.rules.push({field:v.name,op:s[0],data:""}),o.reDraw(),!1}),l.append(y)}if(null!==r){var b=e("<input type='button' value='-' title='"+d("deleteGroupTitle")+"' class='"+c("searchDialog.deleteGroupButton","delete-group")+"'/>");l.append(b),b.on("click",function(){for(n=0;n<r.groups.length;n++)if(r.groups[n]===t){r.groups.splice(n,1);break}return o.reDraw(),o.onchange(),!1})}if(void 0!==t.groups){var w,x,O;for(n=0;n<t.groups.length;n++)w=e("<tr></tr>"),a.append(w),x=e("<td class='first'></td>"),w.append(x),(O=e("<td colspan='4'></td>")).append(this.createTableForGroup(t.groups[n],t)),w.append(O)}if(void 0===t.groupOp&&(t.groupOp=o.p.groupOps[0].op),void 0!==t.rules)for(n=0;n<t.rules.length;n++)a.append(this.createTableRowForRule(t.rules[n],t));return a},this.createTableRowForRule=function(t,n){var o,a,l,f,g=this,m=u(),v=e("<tr></tr>"),y="";v.append("<td class='first'></td>");var b=e("<td class='columns'></td>");v.append(b);var w,x=e("<select class='"+c("searchDialog.label","selectLabel")+"'></select>"),O=[];b.append(x),x.on("change",function(){t.field=e(x).val();var n,o,s=e(this).parents("tr:first");for(o=0;o<g.p.columns.length;o++)if(g.p.columns[o].name===t.field){n=g.p.columns[o];break}if(n){var u=e.extend({},n.editoptions||{});delete u.readonly,delete u.disabled;var d=e.extend({},u||{},n.searchoptions||{},h(n.cmName),{id:r.randId(),name:n.name,mode:"search"});d.column=n,i&&"text"===n.inputtype&&(d.size||(d.size=10));var f=r.createEl.call(m,n.inputtype,e.extend({},d,d.attr||{}),"",!0,g.p.ajaxSelectOptions||{},!0);e(f).addClass(c("searchDialog.elem","input-elm")),a=d.sopt?d.sopt:g.p.sopt?g.p.sopt:-1!==e.inArray(n.searchtype,g.p.strarr)?g.p.stropts:g.p.numopts;var v,y,b,D="",F=0;for(O=[],e.each(g.p.ops,function(){O.push(this.oper)}),g.p.cops&&e.each(g.p.cops,function(e){O.push(e)}),o=0;o<a.length;o++)y=a[o],-1!==(w=e.inArray(a[o],O))&&(b=void 0!==(v=g.p.ops[w])?v.text:g.p.cops[y].text,0===F&&(t.op=y),D+="<option value='"+y+"'>"+b+"</option>",F++);if(e(".selectopts",s).empty().append(D),e(".selectopts",s)[0].selectedIndex=0,r.msie&&r.msiever()<9){var k=parseInt(e("select.selectopts",s)[0].offsetWidth,10)+1;e(".selectopts",s).width(k),e(".selectopts",s).css("width","auto")}if(e(".data",s).empty().append(f),l.createColumnIndex&&d.generateDatalist){var q="dl_"+f.id,A=e(m).jqGrid("generateDatalistFromColumnIndex",l.name);null!=A&&A.length>0&&(e(f).attr("list",q),e(".data",s).append(A.attr("id",q)))}r.bindEv.call(m,f,d),e(".input-elm",s).on("change",d,function(r){var n=r.target,o=r.data.column;t.data=o&&"custom"===o.inputtype&&p(o.searchoptions.custom_value)?o.searchoptions.custom_value.call(m,e(this).find(".customelement").first(),"get"):n.value,e(n).is("input[type=checkbox]")&&!e(n).is(":checked")&&(t.data=e(n).data("offval")),g.onchange()}),setTimeout(function(){t.data=e(f).val(),g.onchange()},0)}});var D,F,k=0;for(o=0;o<g.p.columns.length;o++)D=void 0===g.p.columns[o].search||g.p.columns[o].search,F=!0===g.p.columns[o].hidden,(!0===g.p.columns[o].searchoptions.searchhidden&&D||D&&!F)&&(f="",t.field===g.p.columns[o].name&&(f=" selected='selected'",k=o),y+="<option value='"+g.p.columns[o].name+"'"+f+">"+g.p.columns[o].label+"</option>");x.append(y);var q=e("<td class='operators'></td>");v.append(q),l=s.columns[k],i&&"text"===l.inputtype&&(l.searchoptions.size||(l.searchoptions.size=10));var A=e.extend({},l.editoptions||{});delete A.readonly,delete A.disabled;var j=e.extend({},A,l.searchoptions||{},h(l.cmName),{id:r.randId(),name:l.name});j.column=l;var R=r.createEl.call(m,l.inputtype,e.extend({},j,j.attr||{}),t.data,!0,g.p.ajaxSelectOptions||{},!0);("nu"===t.op||"nn"===t.op||e.inArray(t.op,m.p.customUnaryOperations)>=0)&&(e(R).attr("readonly","true"),e(R).attr("disabled","true"));var S=e("<select class='"+c("searchDialog.operator","selectopts")+"'></select>");q.append(S),S.on("change",function(){t.op=e(S).val();var r=e(this).parents("tr:first"),n=e(".input-elm",r)[0];"nu"===t.op||"nn"===t.op||e.inArray(t.op,m.p.customUnaryOperations)>=0?(t.data="","SELECT"!==n.tagName.toUpperCase()&&(n.value=""),n.setAttribute("readonly","true"),n.setAttribute("disabled","true")):("SELECT"===n.tagName.toUpperCase()&&(t.data=n.value),n.removeAttribute("readonly"),n.removeAttribute("disabled")),g.onchange()}),a=l.searchoptions.sopt?l.searchoptions.sopt:g.p.sopt?g.p.sopt:-1!==e.inArray(l.searchtype,g.p.strarr)?g.p.stropts:g.p.numopts,y="";var C,G;for(e.each(g.p.ops,function(){O.push(this.oper)}),g.p.cops&&e.each(g.p.cops,function(e){O.push(e)}),o=0;o<a.length;o++)G=a[o],-1!==(w=e.inArray(a[o],O))&&(C=g.p.ops[w],y+="<option value='"+G+"'"+(f=t.op===G?" selected='selected'":"")+">"+(void 0!==C?C.text:g.p.cops[G].text)+"</option>");S.append(y);var B=e("<td class='data'></td>");if(v.append(B),B.append(R),l.createColumnIndex&&l.searchoptions.generateDatalist){var E="dl_"+R.id,N=e(m).jqGrid("generateDatalistFromColumnIndex",l.name);null!=N&&N.length>0&&(e(R).attr("list",E),B.append(N.attr("id",E)))}r.bindEv.call(m,R,l.searchoptions),e(R).addClass(c("searchDialog.elem","input-elm")).on("change",function(){t.data="custom"===l.inputtype?l.searchoptions.custom_value.call(m,e(this).find(".customelement").first(),"get"):e(this).val(),e(this).is("input[type=checkbox]")&&!e(this).is(":checked")&&(t.data=e(this).data("offval")),e.isArray(t.data)&&(t.data=t.data.join(s.inFilterSeparator||",")),g.onchange()});var T=e("<td></td>");if(v.append(T),!0===s.ruleButtons){var I=e("<input type='button' value='-' title='"+d("deleteRuleTitle")+"' class='"+c("searchDialog.deleteRuleButton","delete-rule ui-del")+"'/>");T.append(I),I.on("click",function(){for(o=0;o<n.rules.length;o++)if(n.rules[o]===t){n.rules.splice(o,1);break}return g.reDraw(),g.onchange(),!1})}return v},this.getStringForGroup=function(e){var t,r="(";if(void 0!==e.groups)for(t=0;t<e.groups.length;t++){r.length>1&&(r+=" "+e.groupOp+" ");try{r+=this.getStringForGroup(e.groups[t])}catch(e){l(e)}}if(void 0!==e.rules)try{for(t=0;t<e.rules.length;t++)r.length>1&&(r+=" "+e.groupOp+" "),r+=this.getStringForRule(e.rules[t])}catch(e){l(e)}return"()"==(r+=")")?"":r},this.getStringForRule=function(t){var r,n,o,a="",i="",l=t.data,c=["int","integer","float","number","currency"];for(r=0;r<s.ops.length;r++)if(s.ops[r].oper===t.op){a=s.operands.hasOwnProperty(t.op)?s.operands[t.op]:"",i=s.ops[r].oper;break}if(""===i&&null!=s.cops)for(o in s.cops)if(s.cops.hasOwnProperty(o)&&(i=o,a=s.cops[o].operand,p(s.cops[o].buildQueryValue)))return s.cops[o].buildQueryValue.call(s,{cmName:t.field,searchValue:l,operand:a});for(r=0;r<s.columns.length;r++)if(s.columns[r].name===t.field){n=s.columns[r];break}return null==n?"":("bw"!==i&&"bn"!==i||(l+="%"),"ew"!==i&&"en"!==i||(l="%"+l),"cn"!==i&&"nc"!==i||(l="%"+l+"%"),"in"!==i&&"ni"!==i||(l=" ("+l+")"),s.errorcheck&&m(t.data,n),-1!==e.inArray(n.searchtype,c)||"nn"===i||"nu"===i||e.inArray(i,u().p.customUnaryOperations)>=0?t.field+" "+a+" "+l:t.field+" "+a+' "'+l+'"')},this.resetFilter=function(){s.filter=e.extend(!0,{},s.initFilter),this.reDraw(),this.onchange()},this.hideError=function(){e("th."+f,this).html(""),e("tr.error",this).hide()},this.showError=function(){e("th."+f,this).html(s.errmsg),e("tr.error",this).show()},this.toUserFriendlyString=function(){return this.getStringForGroup(s.filter)},this.toString=function(){function e(e){if(r.p.errorcheck){var t,n;for(t=0;t<r.p.columns.length;t++)if(r.p.columns[t].name===e.field){n=r.p.columns[t];break}n&&m(e.data,n)}return e.op+"(item."+e.field+",'"+e.data+"')"}function t(r){var n,o="(";if(void 0!==r.groups)for(n=0;n<r.groups.length;n++)o.length>1&&("OR"===r.groupOp?o+=" || ":o+=" && "),o+=t(r.groups[n]);if(void 0!==r.rules)for(n=0;n<r.rules.length;n++)o.length>1&&("OR"===r.groupOp?o+=" || ":o+=" && "),o+=e(r.rules[n]);return"()"==(o+=")")?"":o}var r=this;return t(s.filter)},this.reDraw(),s.showQuery&&this.onchange(),this.filter=!0}}})},e.extend(e.fn.jqFilter,{toSQLString:function(){var e="";return this.each(function(){e=this.toUserFriendlyString()}),e},filterData:function(){var e;return this.each(function(){e=this.p.filter}),e},getParameter:function(e){return void 0!==e&&this.p.hasOwnProperty(e)?this.p[e]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(t){"string"==typeof t&&(t=e.parseJSON(t)),this.each(function(){this.p.filter=t,this.reDraw(),this.onchange()})}})});
//# sourceMappingURL=grid.filter.js.map