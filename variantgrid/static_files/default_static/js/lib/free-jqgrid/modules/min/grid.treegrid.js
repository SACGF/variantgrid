!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],e):"object"==typeof module&&module.exports?module.exports=function(r,t){return r||(r=window),void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(r)),require("./grid.base"),e(t),t}:e(jQuery)}(function(e){"use strict";var r=e.jgrid,t=r.getAccessor,a=r.stripPref,i=r.jqID,d=e.fn.jqGrid,l=function(){var t=e.makeArray(arguments);return t[0]="treeGrid"+t[0].charAt(0).toUpperCase()+t[0].substring(1),t.unshift(""),t.unshift(""),t.unshift(this.p),r.feedback.apply(this,t)},n=function(e,r){var t=r[e.treeReader.icon_field],a=e.treeIcons,i=a.plus+" tree-plus",d=a.minus+" tree-minus";return t&&"string"==typeof t&&2===(t=t.split(",")).length&&(d=t[0],i=t[1]),{expanded:d,collapsed:i,common:a.commonIconClass}};r.extend({setTreeNode:function(){return this.each(function(){var r=this,t=e(r),i=r.p;if(r.grid&&i.treeGrid){var l=i.treeReader.expanded_field,n=i.treeReader.leaf_field;t.off("jqGridBeforeSelectRow.setTreeNode"),t.on("jqGridBeforeSelectRow.setTreeNode",function(r,o,s){if(null!=s){var c=e(s.target),f=c.closest("tr.jqgrow>td"),p=f.parent(),h=function(){var e=i.data[i._index[a(i.idPrefix,o)]],r=e[l]?"collapse":"expand";e[n]||(d[r+"Row"].call(t,e,p),d[r+"Node"].call(t,e,p))};return c.is("div.treeclick")?h():i.ExpandColClick&&f.length>0&&c.closest("span.cell-wrapper",f).length>0&&h(),!0}})}})},setTreeGrid:function(){return this.each(function(){var r,t,a,i=this,d=i.p,l=[],n=["leaf_field","expanded_field","loaded"];if(d.treeGrid){d.treedatatype||e.extend(i.p,{treedatatype:d.datatype}),d.subGrid=!1,d.altRows=!1,d.pgbuttons=!1,d.pginput=!1,d.gridview=!0,null===d.rowTotal&&(d.rowNum=d.maxRowNum),d.rowList=[],d.treeIcons.plus="rtl"===d.direction?d.treeIcons.plusRtl:d.treeIcons.plusLtr,"nested"===d.treeGridModel?d.treeReader=e.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},d.treeReader):"adjacency"===d.treeGridModel&&(d.treeReader=e.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},d.treeReader));for(t in d.colModel)if(d.colModel.hasOwnProperty(t)){r=d.colModel[t].name;for(a in d.treeReader)d.treeReader.hasOwnProperty(a)&&d.treeReader[a]===r&&l.push(r)}e.each(d.treeReader,function(r){var t=String(this);t&&-1===e.inArray(t,l)&&(e.inArray(r,n)>=0?d.additionalProperties.push({name:t,search:!1,convert:function(e){return!0===e||"true"===String(e).toLowerCase()||"1"===String(e)||e}}):d.additionalProperties.push(t))})}})},expandRow:function(r){this.each(function(){var a=this,i=e(a),n=a.p;if(a.grid&&n.treeGrid){var o=n.treeReader.expanded_field,s=r[n.localReader.id];if(l.call(a,"beforeExpandRow",{rowid:s,item:r})){var c=d.getNodeChildren.call(i,r);e(c).each(function(){var r=n.idPrefix+t(this,n.localReader.id);e(d.getGridRowById.call(i,r)).css("display",""),this[o]&&d.expandRow.call(i,this)}),l.call(a,"afterExpandRow",{rowid:s,item:r})}}})},collapseRow:function(r){this.each(function(){var a=this,i=e(a),n=a.p;if(a.grid&&n.treeGrid){var o=n.treeReader.expanded_field,s=r[n.localReader.id];if(l.call(a,"beforeCollapseRow",{rowid:s,item:r})){var c=d.getNodeChildren.call(i,r);e(c).each(function(){var r=n.idPrefix+t(this,n.localReader.id);e(d.getGridRowById.call(i,r)).css("display","none"),this[o]&&d.collapseRow.call(i,this)}),l.call(a,"afterCollapseRow",{rowid:s,item:r})}}})},getRootNodes:function(){var r=[];return this.each(function(){var t=this,a=t.p;if(t.grid&&a.treeGrid)switch(a.treeGridModel){case"nested":var i=a.treeReader.level_field;e(a.data).each(function(){parseInt(this[i],10)===parseInt(a.tree_root_level,10)&&r.push(this)});break;case"adjacency":var d=a.treeReader.parent_id_field;e(a.data).each(function(){null!==this[d]&&"null"!==String(this[d]).toLowerCase()||r.push(this)})}}),r},getNodeDepth:function(r){var t=null;return this.each(function(){var a=this,i=a.p;if(a.grid&&i.treeGrid)switch(i.treeGridModel){case"nested":var l=i.treeReader.level_field;t=parseInt(r[l],10)-parseInt(i.tree_root_level,10);break;case"adjacency":t=d.getNodeAncestors.call(e(a),r).length}}),t},getNodeParent:function(r){var t=this[0];if(!t||!t.grid||null==t.p||!t.p.treeGrid||null==r)return null;var a=t.p,i=a.treeReader,d=r[i.parent_id_field];if("nested"===a.treeGridModel){var l=null,n=i.left_field,o=i.right_field,s=i.level_field,c=parseInt(r[n],10),f=parseInt(r[o],10),p=parseInt(r[s],10);return e(a.data).each(function(){if(parseInt(this[s],10)===p-1&&parseInt(this[n],10)<c&&parseInt(this[o],10)>f)return l=this,!1}),l}if(null===d||"null"===d)return null;var h=a._index[d];return void 0!==h?a.data[h]:null},getNodeChildren:function(r){var t=[];return this.each(function(){var a=this,i=a.p;if(a.grid&&i.treeGrid)switch(i.treeGridModel){case"nested":var d=i.treeReader.left_field,l=i.treeReader.right_field,n=i.treeReader.level_field,o=parseInt(r[d],10),s=parseInt(r[l],10),c=parseInt(r[n],10);e(i.data).each(function(){parseInt(this[n],10)===c+1&&parseInt(this[d],10)>o&&parseInt(this[l],10)<s&&t.push(this)});break;case"adjacency":var f=i.treeReader.parent_id_field,p=i.localReader.id;e(i.data).each(function(){String(this[f])===String(r[p])&&t.push(this)})}}),t},getFullTreeNode:function(r){var t=[];return this.each(function(){var a,i=this,d=i.p;if(i.grid&&d.treeGrid)switch(d.treeGridModel){case"nested":var l=d.treeReader.left_field,n=d.treeReader.right_field,o=d.treeReader.level_field,s=parseInt(r[l],10),c=parseInt(r[n],10),f=parseInt(r[o],10);e(d.data).each(function(){parseInt(this[o],10)>=f&&parseInt(this[l],10)>=s&&parseInt(this[l],10)<=c&&t.push(this)});break;case"adjacency":if(r){t.push(r);var p=d.treeReader.parent_id_field,h=d.localReader.id;e(d.data).each(function(){var e;for(a=t.length,e=0;e<a;e++)if(String(t[e][h])===String(this[p])){t.push(this);break}})}}}),t},getNodeAncestors:function(r){var t=[];return this.each(function(){var a=this,i=e(a),l=d.getNodeParent;if(a.grid&&a.p.treeGrid)for(var n=l.call(i,r);n;)t.push(n),n=l.call(i,n)}),t},isVisibleNode:function(r){var t=!0;return this.each(function(){var a=this,i=a.p;if(a.grid&&i.treeGrid){var l=d.getNodeAncestors.call(e(a),r),n=i.treeReader.expanded_field;e(l).each(function(){if(!(t=t&&this[n]))return!1})}}),t},isNodeLoaded:function(r){var t;return this.each(function(){var a=this,i=a.p;if(a.grid&&i.treeGrid){var l=i.treeReader.leaf_field,n=i.treeReader.loaded;t=void 0!==r&&(void 0!==r[n]?r[n]:!!(r[l]||d.getNodeChildren.call(e(a),r).length>0))}}),t},expandNode:function(r){return this.each(function(){var a,o,s,c=this,f=c.p;if(c.grid&&f.treeGrid){var p=f.treeReader;if(!r[p.expanded_field]){if(a=t(r,f.localReader.id),!l.call(c,"beforeExpandNode",{rowid:a,item:r}))return;o=e("#"+f.idPrefix+i(a),c.grid.bDiv)[0],r[p.expanded_field]=!0,s=n(f,r),e("div.treeclick",o).removeClass(s.collapsed).addClass(s.common).addClass(s.expanded),"local"===f.treedatatype||d.isNodeLoaded.call(e(c),f.data[f._index[a]])||c.grid.hDiv.loading||(f.treeANode=o.rowIndex,f.datatype=f.treedatatype,d.setGridParam.call(e(c),{postData:"nested"===f.treeGridModel?{nodeid:a,n_level:r[p.level_field],n_left:r[p.left_field],n_right:r[p.right_field]}:{nodeid:a,n_level:r[p.level_field],parentid:r[p.parent_id_field]}}),e(c).trigger("reloadGrid"),r[p.loaded]=!0,d.setGridParam.call(e(c),{postData:"nested"===f.treeGridModel?{nodeid:"",n_level:"",n_left:"",n_right:""}:{nodeid:"",n_level:"",parentid:""}})),l.call(c,"afterExpandNode",{rowid:a,item:r})}}})},collapseNode:function(r){return this.each(function(){var a,d=this,o=d.p;if(d.grid&&o.treeGrid){var s=o.treeReader.expanded_field;if(r[s]){var c=t(r,o.localReader.id);if(!l.call(d,"beforeCollapseNode",{rowid:c,item:r}))return;r[s]=!1,a=n(o,r),e("#"+o.idPrefix+i(c),d.grid.bDiv).find("div.treeclick").removeClass(a.expanded).addClass(a.common).addClass(a.collapsed),(!0===o.unloadNodeOnCollapse||e.isFunction(o.unloadNodeOnCollapse)&&o.unloadNodeOnCollapse.call(d,r))&&(r[o.treeReader.loaded]=!1,e(d).jqGrid("delTreeNode",c,!0)),l.call(d,"afterCollapseNode",{rowid:c,item:r})}}})},SortTree:function(a,l,n,o){return this.each(function(){var s=this,c=s.p,f=e(s);if(s.grid&&c.treeGrid){var p,h,u,v=[],g=d.getRootNodes.call(f),_=r.from.call(s,g);_.orderBy(a,l,n,o);var R=_.select();for(p=0,h=R.length;p<h;p++)u=R[p],v.push(u),d.collectChildrenSortTree.call(f,v,u,a,l,n,o);e.each(v,function(r){var a=t(this,c.localReader.id);e(s.rows[r]).after(f.find(">tbody>tr#"+i(a)))})}})},collectChildrenSortTree:function(t,a,i,l,n,o){return this.each(function(){var s=this,c=e(s);if(s.grid&&s.p.treeGrid){var f,p,h,u=d.getNodeChildren.call(c,a),v=r.from.call(s,u);v.orderBy(i,l,n,o);var g=v.select();for(f=0,p=g.length;f<p;f++)h=g[f],t.push(h),d.collectChildrenSortTree.call(c,t,h,i,l,n,o)}})},setTreeRow:function(r,t){var a=!1;return this.each(function(){var i=this;i.grid&&i.p.treeGrid&&(a=d.setRowData.call(e(i),r,t))}),a},delTreeNode:function(t,a){return this.each(function(){var i,l,n,o,s,c=this,f=c.p,p=f.localReader.id,h=e(c),u=f.treeReader.left_field,v=f.treeReader.right_field;if(c.grid&&f.treeGrid){var g=f._index[t];if(void 0!==g){l=(i=parseInt(f.data[g][v],10))-parseInt(f.data[g][u],10)+1;var _=d.getFullTreeNode.call(h,f.data[g]);if(_.length>0)for(s=0;s<_.length;s++)a&&t===_[s][p]||d.delRowData.call(h,_[s][p]);if("nested"===f.treeGridModel){if((n=r.from.call(c,f.data).greater(u,i,{stype:"integer"}).select()).length)for(o in n)n.hasOwnProperty(o)&&(n[o][u]=parseInt(n[o][u],10)-l);if((n=r.from.call(c,f.data).greater(v,i,{stype:"integer"}).select()).length)for(o in n)n.hasOwnProperty(o)&&(n[o][v]=parseInt(n[o][v],10)-l)}}}})},addChildNode:function(t,a,i,l){return this.each(function(){if(i){var n,o,s,c,f,p,h,u=this,v=u.p,g=e(u),_=d.getInd,R=v.treeIcons.minus+" tree-minus",w=a,I=v.treeReader.expanded_field,m=v.treeReader.leaf_field,x=v.treeReader.level_field,y=v.treeReader.parent_id_field,G=v.treeReader.left_field,N=v.treeReader.right_field,C=v.treeReader.loaded;void 0===l&&(l=!1),null==t&&(t=r.randId());var b=_.call(g,a);if(p=!1,void 0===a||null===a||""===a)a=null,w=null,n="last",c=v.tree_root_level;else{n="after",o=v._index[a],s=v.data[o],a=s[v.localReader.id],f=_.call(g,a),c=parseInt(s[x],10)+1;var P=d.getFullTreeNode.call(g,s);if(P.length){var j,M,T;for(j=0;j<P.length;j++)T=P[j][v.localReader.id],(M=_.call(g,T))>f&&(f=M,w=T)}s[m]&&(p=!0,s[I]=!0,e(u.rows[b]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(v.treeIcons.leaf+" tree-leaf").addClass(v.treeIcons.commonIconClass).addClass(R),v.data[o][m]=!1,s[C]=!0)}if(void 0===i[I]&&(i[I]=!1),void 0===i[C]&&(i[C]=!1),i[x]=c,void 0===i[m]&&(i[m]=!0),"adjacency"===v.treeGridModel&&(i[y]=a),"nested"===v.treeGridModel){var S,k,q;if(null!==a){if(h=parseInt(s[N],10),S=r.from.call(u,v.data),S=S.greaterOrEquals(N,h,{stype:"integer"}),(k=S.select()).length)for(q in k)k.hasOwnProperty(q)&&(k[q][G]=k[q][G]>h?parseInt(k[q][G],10)+2:k[q][G],k[q][N]=k[q][N]>=h?parseInt(k[q][N],10)+2:k[q][N]);i[G]=h,i[N]=h+1}else{if(h=parseInt(d.getCol.call(g,N,!1,"max"),10),(k=r.from.call(u,v.data).greater(G,h,{stype:"integer"}).select()).length)for(q in k)k.hasOwnProperty(q)&&(k[q][G]=parseInt(k[q][G],10)+2);if((k=r.from.call(u,v.data).greater(N,h,{stype:"integer"}).select()).length)for(q in k)k.hasOwnProperty(q)&&(k[q][N]=parseInt(k[q][N],10)+2);i[G]=h+1,i[N]=h+2}}(null===a||d.isNodeLoaded.call(g,s)||p)&&d.addRowData.call(g,t,i,n,w),s&&!s[I]&&l&&e(u.rows[b]).find("div.treeclick").click()}})}})});
//# sourceMappingURL=grid.treegrid.js.map