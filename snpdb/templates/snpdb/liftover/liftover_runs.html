{% extends "uicore/page/base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load js_tags %}
{% load ui_utils %}
{% load ui_help %}
{% load ui_menu_bars %}
{% block title %}Liftover{% endblock %}
{% block submenu %}
{% if 'variants'|is_view_enabled %}
    {% menu_bar_variants %}
{% else %}
    {% menu_bar_settings %}
{% endif %}
{% endblock submenu %}
{% block content %}
    <div class="container">
        <h3>Liftover Stats</h3>

        <p class="text-info">Note: We only run some tools after others have failed</p>
        <table class="table">
            <tr>
                <th>Tool</th>
            {% for pc in processing_status_cols %}
                <th>{{ pc.label }}</th>
            {% endfor %}
                <th>Failure %</th>
            </tr>

        {% for act, data in tool_status.items %}
            <tr>
                <td>{{ act }}</td>
            {% for pc in processing_status_cols %}
                <td>{{ data|get_item:pc|default_if_none:0 }}</td>
            {% endfor %}
                <td>{{ failure_rate|get_item:act|default_if_none:'-'|floatformat:2 }}</td>
            </tr>
        {% endfor %}
        </table>
    </div>

    <div class="container">
        <h3>Alleles</h3>
        <form method="post">
            {% csrf_token %}

            <table>
            {% for genome_build_name, count in alleles_missing_variants.items %}
                <tr>
                    <th>Alleles missing {{ genome_build_name }} variants: </th>
                    <td>{{ count }}</td>
                    <td>{% if count %}<button name="liftover_to_{{ genome_build_name }}" class="btn btn-secondary">Liftover variants</button>{% endif %}</td>
                </tr>
            {% endfor %}
            </table>
        </form>
    </div>

    <div class="container">
        <h3>Liftover Runs</h3>

        <table id="liftover-datatable" data-datatable-url="{% url 'liftover_runs_datatable' %}" class="sticky-header responsive"></table>
    </div>

    <div class="container">
        {% for genome_build in genome_builds %}
            <script>
                function datatableFilter{{ genome_build.name }}(data) {
                    data.genome_build_name = "{{ genome_build.name }}";
                }
            </script>

            <h3>Failed Liftover to {{ genome_build }}</h3>

            <table data-datatable-url="{% url 'allele_liftover_failures_datatable' %}" data-datatable-data='datatableFilter{{ genome_build.name }}' class="import-table sticky-header" responsive="true"></table>

        {% endfor %}
    </div>


{% endblock %}


