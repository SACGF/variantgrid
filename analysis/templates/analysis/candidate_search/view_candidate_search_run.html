{% extends "uicore/page/base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% load js_tags %}
{% load compress %}
{% load ui_utils %}
{% load ui_help %}
{% load ui_menu_bars %}
{% load settings_tags %}
{% load classification_tags %}
{% block title %}Classification Candidate Search: {{ candidate_search_run }}{% endblock %}
{% block submenu %}{% menu_bar_classifications %}{% endblock submenu %}
{% block head %}
<style>
.c-pill {
    width: 50px; /* shrink a lot */
}
</style>

<script>
function classification_summary_renderer(data, type, row) {
    const CLIN_SIG = {
        '1': 'B',
        '2': 'LB',
        '3': 'VUS',
        '4': 'LP',
        '5': 'P',
    }
    let outterDom = $('<div>').css("display", "inline-block");
    let dom = $('<div>').appendTo(outterDom);

    let hgvs = data["c_hgvs"] || data["g_hgvs"];
    let classificationId = data["classification"];
    let classificationUrl = Urls.view_classification(classificationId);
    let classificationLink = $("<a>", {href: classificationUrl, html: hgvs})
    dom.append(classificationLink);
    let csVal = CLIN_SIG[data["clinical_significance"]] || "";
    let csClass = `cs-` + (csVal || '').toLowerCase()
    dom.append($('<span>', {class: `c-pill cs ${csClass}`, html: csVal}));
    return outterDom;
}
</script>
{% endblock %}
{% block content %}
<div class="container">

    {% with back_url=candidate_search_run.search_version.get_type_base_page_url %}
        {% if back_url %}
            <a href="{{ back_url }}">Back to runs</a>
        {% endif %}
    {% endwith %}

    <div class="card">
        <div class="card-header">{{ candidate_search_run }}</div>
        <div class="card-body">
            {% labelled id='search_version' label='' hint="tiny" %}{{ candidate_search_run.search_version }}{% endlabelled %}
            {% labelled id='created' label='Created' hint="tiny" %}{{ candidate_search_run.created }}{% endlabelled %}
            {% labelled id='user' label='User' hint="tiny" %}{{ candidate_search_run.user }}{% endlabelled %}
            {% labelled id='celery_task' label='Celery Task' hint="tiny" %}{{ candidate_search_run.celery_task }}{% endlabelled %}
            {% labelled id='status' label='Status' hint="tiny" %}{{ candidate_search_run.get_status_display }}{% endlabelled %}
            {% labelled id='error_exception' label='Error' hint="tiny" %}{{ candidate_search_run.error_exception }}{% endlabelled %}
            {% labelled id='config_snapshot' label='Config' hint="tiny" %}{{ candidate_search_run.config_snapshot }}{% endlabelled %}
            {% labelled id='git_hash' label='' hint="tiny" %}{{ candidate_search_run.git_hash }}{% endlabelled %}
        </div>
    </div>

    {% if candidate_search_run.status == 'S' %}
        <div>
            <table id="candidate-datatable" data-datatable-url="{% url 'candidate_datatable' candidate_search_run.pk %}" class="sticky-header samples-table" data-adjust-columns="false"></table>
        </div>
    {% endif %}

</div>
{% endblock %}
