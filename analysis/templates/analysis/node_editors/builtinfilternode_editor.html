{% extends "analysis/node_editors/grid_editor.html" %}

{% block content %}
<style>
	#id_percent {
		width: 100px;
	}
</style>
<script>
    function setupClinVarStars(bifForm) {
        let bifSelect = $("#id_built_in_filter", bifForm);
        let starsContainer = $("#django-starfield-clinvar_stars_min");

        // We need to add a zero radio input, because it doesn't save to DB when none are selected.
        let inputZero = $("<input/>", {id:"clinvar_stars_min-zero", name:"clinvar_stars_min", type:"radio", value:"0"})
        starsContainer.append(inputZero);

        // Make a "clear" link - to be able to have zero stars
        let clearLink = $("<a/>", {id: "zero-stars-link", href: "javascript:clearStars()"}).text("Show all (set to zero stars)");
        starsContainer.after(clearLink);

        function checkSelectedStars() {
            let numStars = getStarsRadioInputs().filter(":checked").val();
            if (numStars) {
                clearLink.show();
            } else {
                $("#zero-stars-link").hide();
            }
        }

        getStarsRadioInputs().change(checkSelectedStars);
        checkSelectedStars();

        function checkClinVarStarsVisibility() {
            if (bifSelect.val() == 'C') {
                $("label[for=id_clinvar_stars_min]").show();
                starsContainer.show();
            } else {
                $("label[for=id_clinvar_stars_min]").hide();
                starsContainer.hide();
            }
        }

        bifSelect.change(checkClinVarStarsVisibility);
        checkClinVarStarsVisibility();
    }

    function getStarsRadioInputs() {
        let starsContainer = $("#django-starfield-clinvar_stars_min");
        return $('input[type="radio"]', starsContainer);
    }

    function clearStars() {
        $("#zero-stars-link").hide();
        getStarsRadioInputs().prop('checked', false);
        $("#clinvar_stars_min-zero").prop("checked", "checked");
    }

    $(document).ready(function() {
        let bifForm = $("form#built-in-filter");
        ajaxForm(bifForm);

        setupClinVarStars(bifForm);
    });
</script>
<div>
	<form id="built-in-filter" method="post" action="{{ request.path }}">
        {% csrf_token %}
        {% for hidden in form.hidden_fields %}
            {{ hidden }}
        {% endfor %}
        {{ form.as_p }}
        {% if has_write_permission %}
		    <button id='built-in-filter-save' class="btn btn-primary">save</button>
        {% endif %}
        {{ form.media }}
	</form>
</div>

{% endblock content %}