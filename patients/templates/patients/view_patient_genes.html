{% load jqgrid_tags %}
{% load ui_utils %}
<div id="patient-genes">
<script>
    $(document).ready(() => {
        {% update_django_messages %}
    });

    // TODO: this is copy/pasted from phenotypenode_editor - merge?
    function addDownloadLink(grid, pagerId, url) {
        var download_grid = function() {
                window.location = url;
        };

        grid.jqGrid('navButtonAdd', pagerId, {
                    caption : "Download",
                    buttonicon : "ui-icon-arrowthickstop-1-s",
                    onClickButton : download_grid,
                    position : "first",
                    title : "Export",
                    cursor : "pointer"
        });
    }


    function patient_hpo_genes_grid_init_func(grid, pagerId, kwargs) {
        var patient_id = kwargs['patient_id'];
        if (patient_id) {
            var url = Urls.patient_hpo_genes_grid({patient_id: patient_id, genome_build_name: "{{ genome_build.name }}", op: 'download'});
            addDownloadLink(grid, pagerId, url);
        }
    }

    function patient_mim_genes_grid_init_func(grid, pagerId, kwargs) {
        var patient_id = kwargs['patient_id'];
        if (patient_id) {
            var url = Urls.patient_mim_genes_grid({patient_id: patient_id, genome_build_name: "{{ genome_build.name }}", op: 'download'});
            addDownloadLink(grid, pagerId, url);
        }
    }
</script>
<div class="row">
    <div class="col-12 col-md-6">
        <div class="card">
            <div class="card-header">Patient HPO:</div>
            <div class="card-body">
            {% if patient.get_hpo_qs.exists %}
            {% jqgrid 'patient_hpo_genes_grid' 'patient-hpo-genes' init_func='patient_hpo_genes_grid_init_func' search=False patient_id=patient.pk genome_build_name=genome_build.name %}
            {% else %}
                <p>Patient has no HPO set.
            {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-12 col-md-6">
        <div class="card">
            <div class="card-header">Patient OMIM:</div>
            <div class="card-body">
            {% if patient.get_mim_qs.exists %}
            {% jqgrid 'patient_mim_genes_grid' 'patient-mim-genes' init_func='patient_mim_genes_grid_init_func' search=False patient_id=patient.pk genome_build_name=genome_build.name %}
            {% else %}
                <p>Patient has no OMIM set.
            {% endif %}
            </div>
        </div>
    </div>
    <div class='clear'></div>
</div>
</div>